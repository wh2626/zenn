---
title: "ã€Reactã€‘createPortalã‚’ä½¿ã£ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ"
emoji: "ğŸšª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['react']
published: false
publication_name: "spacemarket"
---

ã“ã‚“ã«ã¡ã¯ï¼
[ã‚¹ãƒšãƒ¼ã‚¹ãƒãƒ¼ã‚±ãƒƒãƒˆ](https://www.spacemarket.com/)ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã—ã¦ã„ã‚‹wharaguchiã§ã™ã€‚

å…ˆæ—¥createPortal APIã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã®ã§ã€ä»Šå›ã¯ãã¡ã‚‰ã«ã¤ã„ã¦æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## createPortalã¨ã¯

createPortalã¨ã¯ã€ReactãŒæä¾›ã—ã¦ã„ã‚‹APIã§ã€DOMä¸Šã®ä»»æ„ã®å ´æ‰€ã«è¦ç´ ã‚’ãƒ¬ãƒ³ãƒ€ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã‚‹APIã§ã™ã€‚

https://ja.react.dev/reference/react-dom/createPortal

ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ãã®ã¾ã¾å¼•ç”¨ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ã«ç¬¬ä¸€å¼•æ•°ã«ãƒ¬ãƒ³ãƒ€ãƒ¼ã—ãŸã‚‚ã®ã€ç¬¬äºŒå¼•æ•°ã«ãƒ¬ãƒ³ãƒ€ãƒ¼å…ˆã«æŒ‡å®šã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚
ã¾ãŸç¬¬ä¸‰å¼•æ•°ã«ä¸€æ„ã®keyã‚’æ¸¡ã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```tsx
import { createPortal } from 'react-dom';

<div>
  <p>This child is placed in the parent div.</p>
  {createPortal(
    <p>This child is placed in the document body.</p>,
    document.body
  )}
</div>
```

ã“ã®APIã‚’ä½¿ã£ã¦ã€ãƒšãƒ¼ã‚¸å†…ã®ä»»æ„ã®ç®‡æ‰€ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

## ä½œã£ãŸã‚‚ã®

ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œã‚Šã¾ã—ãŸã€‚
https://codesandbox.io/p/sandbox/createportal-x5hrm3

ä»Šå›ã¯ã€äºˆç´„ä¸€è¦§ã«ã‚ã‚‹äºˆç´„ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸäºˆç´„ã«å¯¾ã—ã‚¹ã‚¿ã‚¤ãƒ«ãŒä»˜ä¸ã•ã‚Œã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå·®ã—è¾¼ã¾ã‚Œã‚‹ã¨ã„ã†å®Ÿè£…ã‚’ã—ã¾ã—ãŸã€‚

`createPortal`ã‚’ä½¿ç”¨ã—ãŸ`Highlight`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã€ãã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™`ReserveListPage`ã®2ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚

```tsx:Highlight.tsx
/**
 * @param targetDom ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚ã¦ã‚‹å¯¾è±¡
 * @param insertDom targetDomã‚’insertã™ã‚‹å¯¾è±¡
 * @param isOpen ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹
 * @param close ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’é–‰ã˜ã‚‹ãŸã‚ã®é–¢æ•°
 * @param highlightStyle targetDomã«ä»˜ä¸ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
export const Highlight: FC<HighlightProps> = ({
  targetDom,
  insertDom,
  isOpen,
  close,
  highlightStyle,
}) => {
  useEffect(() => {
    const addBaseHighlightStyle: Record<string, string> = {
      ...highlightStyle,
      position: "relative",
      "z-index": "701",
    };
    Object.keys(addBaseHighlightStyle).forEach((key) => {
      targetDom?.style.setProperty(
        key,
        isOpen ? addBaseHighlightStyle[key] : ""
      );
    });
  }, [targetDom?.style, highlightStyle, isOpen]);
  if (!isOpen) return null;
  if (!insertDom) return null;
  return createPortal(<Overlay close={close} />, insertDom);
};

const Overlay = ({ close }: { close: () => void }) => (
  <div className="overlay" onClick={close} />
);
```

ä»Šå›ã¯5ã¤ã®propsã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
ãã‚Œãã‚Œã®propsã®èª¬æ˜ã¯ã€JSDocã«æ›¸ã„ã¦ã‚ã‚‹ã¨ãŠã‚Šã§ã™ã€‚

ç°¡å˜ã«èª¬æ˜ã™ã‚‹ã¨ã€`isOpen`ãŒtrueã§ã‚ã‚Œã°ã€ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä»˜ä¸ã—ãŸã„å¯¾è±¡ï¼ˆ`targetDom`ï¼‰ã«ã€`highlightStyle`ã§æ¸¡ã£ã¦ããŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä»˜ä¸ã—ã€è¦ç´ ã‚’è¿½åŠ ã—ãŸã„å¯¾è±¡ï¼ˆ`insertDom`ï¼‰ã‚’æŒ‡å®šã™ã‚‹ã¨ã„ã£ãŸã“ã¨ã‚’ã—ã¦ã„ã¾ã™ã€‚

æ¬¡ã«`Highlight`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€`ReserveListPage`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¤ã„ã¦ã§ã™ã€‚

```tsx:ReserveListPage.tsx
import { useEffect, useRef, useState } from "react";
import { Highlight } from "./Highlight";

const reserveList = [
  {
    id: 1,
    title: "äºˆç´„",
    text: "äºˆç´„1ã®ãƒ†ã‚­ã‚¹ãƒˆã§ã™ã€‚",
  },
];

export const ReserveListPage = () => {
  const [open, setOpen] = useState(false);
  const [targetIndex, setTargetIndex] = useState<number | null>(null);
  const targetRef = useRef<HTMLDivElement>(null);
  const insertRef = useRef<HTMLLIElement>(null);

  const [targetElement, setTargetElement] = useState<HTMLElement | null>(null);
  const [insertElement, setInsertElement] = useState<HTMLElement | null>(null);

  useEffect(() => {
    setTargetElement(targetRef.current);
    setInsertElement(insertRef.current);
  }, [targetIndex]);

  const handleOpen = (e) => {
    setOpen(true);
    setTargetIndex(e);
  };

  return (
    <div className="wrapper">
      <div className="inner">
        <h1>äºˆç´„ä¸€è¦§</h1>
        <ul className="list">
          {reserveList.map((reserve, index) => {
            const isEditTargetReservation = index === targetIndex;
            return (
              <li
                className="list-item"
                key={reserve.id}
                ref={isEditTargetReservation ? insertRef : undefined}
              >
                <div
                  className="list-item-inner"
                  ref={isEditTargetReservation ? targetRef : undefined}
                >
                  <button onClick={() => handleOpen(index)}>
                    {reserve.title}
                    {reserve.id}
                  </button>
                  {isEditTargetReservation && open && <p>{reserve.text}</p>}
                </div>
              </li>
            );
          })}
        </ul>
      </div>
      <Highlight
        targetDom={targetElement}
        insertDom={insertElement}
        isOpen={open}
        close={() => {
          setOpen(false);
        }}
        highlightStyle={{
          "background-color": "white",
          border: "2px solid red",
        }}
      />
    </div>
  );
};
```

`targetDom`ã¨`insertDom`ã¯`useRef`ã‚’ä½¿ç”¨ã—ã¦å–å¾—ã—ã€ãã‚Œãã‚Œ`Highlight`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã“ã®çŠ¶æ…‹ã§ã€Œäºˆç´„1ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã§`Highlight`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å®šç¾©ã•ã‚ŒãŸ`Overlay`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ`li.list-item`ã«å·®ã—è¾¼ã¾ã‚Œã€`div.list-item-inner`ã«å¯¾ã—ã€`highlightStyle`ã§å®šç¾©ã—ãŸã‚¹ã‚¿ã‚¤ãƒ«ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚

![ã‚µãƒ³ãƒ—ãƒ«](/images/b7dd09f75c40ea/image.png)

```html
<li class="list-item">
  <!-- highlightStyleã§æŒ‡å®šã—ãŸstyleãŒä»˜ä¸ã•ã‚Œã‚‹ -->
  <div class="list-item-inner" style="background-color: white; border: 2px solid red; position: relative; z-index: 701;">
    <button>äºˆç´„1</button>
    <p>äºˆç´„1ã®ãƒ†ã‚­ã‚¹ãƒˆã§ã™ã€‚</p>
  </div>
  <!-- ã“ã“ã«overlayãŒå·®ã—è¾¼ã¾ã‚Œã‚‹ -->
  <div class="overlay"></div>
</li>
```


## æœ€å¾Œã«

ã„ã‹ãŒã ã£ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ
`createPortal`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä½œæˆã—ãŸã‚Šã€ã‚¢ãƒ—ãƒªã§ã‚ˆãè¦‹ã‹ã‘ã‚‹ã‚¦ã‚©ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼ã®ã‚ˆã†ãªè¡¨ç¾ã‚‚ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã¿ãªã•ã‚“ã‚‚ãœã²ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ï¼

## å®£ä¼

ã‚¹ãƒšãƒ¼ã‚¹ãƒãƒ¼ã‚±ãƒƒãƒˆã§ã¯ç¾åœ¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’å‹Ÿé›†ã—ã¦ãŠã‚Šã¾ã™ï¼
ã¡ã‚‡ã£ã¨è©±ã‚’èã„ã¦ã¿ãŸã„ã¨ã„ã£ãŸã‚ˆã†ãªã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ãªé¢è«‡ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã®ã§ã€ã”èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯æ˜¯éã”å¿œå‹ŸãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼